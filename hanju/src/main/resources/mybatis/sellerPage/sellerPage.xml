<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hanju.sellerPage.mapper.SellerPageMapper">

	<select id="test" parameterType="hashmap" resultType="com.example.hanju.sellerPage.model.Test">
		SELECT	*
		FROM	HANJU_NORMAL_SELL
		WHERE	SELL_ID = #{sellId}
	</select>

	<select id="getProductCodeList" parameterType="hashmap" resultType="com.example.hanju.main.model.Code">
		SELECT	*
		FROM	HANJU_CODE
		WHERE	KIND = 'PRODUCT_CODE'
	</select>

	<insert id="registerProduct" parameterType="hashmap" useGeneratedKeys="true" keyProperty="PRODUCT_ID" keyColumn="PRODUCT_ID">
		INSERT INTO HANJU_PRODUCT
		VALUES (
			test_seq.nextVal,
			#{type},
			#{productName},
			#{price},
			#{userId},
			#{madeBy},
			#{alcohol},
			#{sparkling},
			#{sweet},
			#{sour},
			#{bitter},
			#{body},
			#{stock},
			#{capacity},
			#{material},
			SYSDATE
		)
	</insert>
	
	<insert id="uploadProductImg" parameterType="hashmap">
		INSERT INTO HANJU_IMAGE
		VALUES (image_seq.nextVal, #{productId}, #{fileName}, #{fileOrgName}, #{filePath}, #{fileStatus})
	</insert>
	
	<select id="getTotalProductCount" parameterType="hashmap" resultType="Integer">
		SELECT	COUNT(*)
		FROM	HANJU_PRODUCT
		WHERE	SELLER_ID = #{userId}
	</select>
	
	<select id="getProductList" parameterType="hashmap" resultType="com.example.hanju.main.model.Product">
		SELECT	*
		FROM	HANJU_PRODUCT
		WHERE	SELLER_ID = #{userId}
	</select>
	
	<select id="getProductListPaging" parameterType="hashmap" resultType="com.example.hanju.main.model.Product">
		SELECT	*
		FROM	HANJU_PRODUCT P
		INNER JOIN HANJU_CODE C  ON C.KIND = 'PRODUCT_CODE' AND P.TYPE = C.CODE
		LEFT  JOIN HANJU_IMAGE I ON P.PRODUCT_ID = I.FK_ID AND I.FILE_STATUS = 'T'
		WHERE	SELLER_ID = #{userId}
		ORDER BY P.CDATETIME DESC
		OFFSET #{start} ROWS FETCH FIRST #{size} ROWS ONLY
	</select>
	
	<select id="getProductInfo" parameterType="hashmap" resultType="com.example.hanju.main.model.Product">
		SELECT	*
		FROM	HANJU_PRODUCT
		WHERE	PRODUCT_ID = #{productId}
	</select>
	
	<select id="getProductImages" parameterType="hashmap" resultType="com.example.hanju.main.model.ProductImage">
		SELECT	*
		FROM	HANJU_IMAGE I
		INNER JOIN HANJU_PRODUCT P ON I.FK_ID = P.PRODUCT_ID
		WHERE	I.FK_ID = #{productId} AND (I.FILE_STATUS = 'T' OR I.FILE_STATUS = 'P')
	</select>
	
	<update id="modifyProduct" parameterType="hashmap">
		UPDATE HANJU_PRODUCT
		SET
			PRODUCT_NAME = #{productName},
			TYPE         = #{type},
			PRICE        = #{price},
			MADE_BY      = #{madeBy},
			ALCOHOL      = #{alcohol},
			SPARKLING    = #{sparkling},
			SWEET        = #{sweet},
			SOUR         = #{sour},
			BITTER       = #{bitter},
			BODY         = #{body},
			STOCK        = #{stock},
			CAPACITY     = #{capacity},
			MATERIAL     = #{material}
		WHERE PRODUCT_ID = #{productId}
	</update>
	
	<delete id="deleteImage" parameterType="hashmap">
		DELETE FROM HANJU_IMAGE
		WHERE		IMAGE_ID = #{imageId}
	</delete>
	
	<insert id="registerSell" parameterType="hashmap" useGeneratedKeys="true" keyProperty="SELL_ID" keyColumn="SELL_ID">
		INSERT INTO HANJU_NORMAL_SELL
		VALUES (main_seq.nextVal, #{productId}, #{discount}, SYSDATE, null, #{description})
	</insert>
	
	<insert id="registerGroupSell" parameterType="hashmap" useGeneratedKeys="true" keyProperty="GROUP_SELL_ID" keyColumn="GROUP_SELL_ID">
		INSERT INTO TEST_GROUP_SELL
		VALUES (main_seq.nextVal, #{targetAmount}, SYSDATE, #{endDate}, #{discount}, #{productId}, #{description})
	</insert>
	
</mapper>