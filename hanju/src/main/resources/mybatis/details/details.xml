<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hanju.details.mapper.DetailsMapper">

	<select id ="selectDetail" parameterType="hashmap" resultType="Details">
		SELECT *
		FROM HANJU_PRODUCT P
		INNER JOIN HANJU_CODE C ON P.TYPE = C.CODE
		INNER JOIN HANJU_NORMAL_SELL N ON P.PRODUCT_ID = N.PRODUCT_ID
		WHERE N.SELL_ID = #{sellId}
	</select>
	<select id="selectProduct" parameterType="hashmap" resultType="Product">
		SELECT *
		FROM HANJU_PRODUCT P
		INNER JOIN HANJU_NORMAL_SELL N ON P.PRODUCT_ID = N.PRODUCT_ID
		WHERE N.SELL_ID = #{sellId}
	</select>

	<!--픽업매장-->
	<select id="selectPickUpStore" parameterType="hashmap" resultType="pickUpStore">
		SELECT *
		FROM HANJU_PICKUP_STORE
	</select>

	<select id ="selectPickUpProduct" parameterType="hashmap" resultType="Details">
		SELECT *
		FROM HANJU_PRODUCT P
		INNER JOIN HANJU_CODE C ON P.TYPE = C.CODE
		INNER JOIN HANJU_PICKUP_STOCK S ON P.PRODUCT_ID = S.PRODUCT_ID
		INNER JOIN HANJU_PICKUP_STORE S2 ON S.STORE_ID = S2.STORE_ID
		WHERE P.PRODUCT_ID = #{pickupId}
	</select>

	<!--이미지 불러오는 쿼리-->
	<select id="detailImage" parameterType="hashmap" resultType="String">
		SELECT FILE_PATH
		FROM HANJU_IMAGE I
		INNER JOIN HANJU_PRODUCT P ON I.FK_ID = P.PRODUCT_ID
		LEFT JOIN HANJU_NORMAL_SELL N ON P.PRODUCT_ID = N.PRODUCT_ID
		WHERE (N.SELL_ID = #{sellId} AND FILE_STATUS = #{status}) OR (P.PRODUCT_ID = #{pickupId} AND FILE_STATUS = #{status})
	</select>

	<!--리뷰-->
	<select id="selectComment" parameterType="hashmap" resultType="Comment">
		SELECT c.*,replace(user_name, substr(user_name, 2, 1), '*') user_name, i.*
		FROM HANJU_COMMENT C
		INNER JOIN HANJU_USER U ON C.USER_ID = U.USER_ID
		LEFT JOIN HANJU_IMAGE I ON I.FK_ID = C.COMMENT_ID
		WHERE (C.BILL_ID = #{sellId}) OR (C.BILL_ID = #{pickupId})
	</select>

<<<<<<< HEAD
	<select id="selectCommentPickUp" parameterType="hashmap" resultType="Comment">
		SELECT c.*,replace(user_name, substr(user_name, 2, 1), '*') user_name, i.*
		FROM HANJU_COMMENT C
		INNER JOIN HANJU_USER U ON C.USER_ID = U.USER_ID
		LEFT JOIN HANJU_IMAGE I ON I.FK_ID = C.COMMENT_ID
		WHERE C.BILL_ID = #{pickupId}
	</select>
	<select id="getSubscribe" parameterType="hashmap" resultType="Subscribe">
		SELECT *
		FROM HANJU_SUBSCRIBE
		WHERE SUBSCRIBE_ID = #{id}
	</select>
	<select id="getSubscribeItem" parameterType="hashmap" resultType="String">
		SELECT PRODUCT_ID
		FROM HANJU_SUBSCRIBE S
		INNER JOIN HANJU_SUBSCRIBE_ITEM SI ON SI.SUBSCRIBE_ID = S.SUBSCRIBE_ID
		WHERE S.SUBSCRIBE_ID = #{id}
	</select>
=======
>>>>>>> refs/remotes/origin/main

<<<<<<< HEAD
=======

>>>>>>> refs/remotes/origin/main
</mapper>