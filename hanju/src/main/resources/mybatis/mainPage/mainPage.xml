<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hanju.mainPage.mapper.MainPageMapper">

	<select id="getBestNormalSellList" resultType="com.example.hanju.mainPage.model.BestNormalSell">
		SELECT  
		    NS.SELL_ID, 
		    P.PRODUCT_NAME, 
		    TO_CHAR(PRICE, 'FM99,999') AS PRICE_COMMA, 
		    NS.DISCOUNT, 
		    I.FILE_PATH,
		    TO_CHAR((PRICE - (PRICE * (DISCOUNT / 100))), 'FM99,999') AS DISCOUNT_PRICE
		FROM    (
		    SELECT  PRODUCT_ID, KIND, COUNT(*) AS CNT
		    FROM    HANJU_BILL
		    WHERE   KIND = 'N'
		    GROUP BY PRODUCT_ID, KIND
		    ORDER BY CNT DESC
		    OFFSET 0 ROWS FETCH FIRST 10 ROWS ONLY
		) BEST
		INNER JOIN HANJU_PRODUCT P ON BEST.PRODUCT_ID = P.PRODUCT_ID
		INNER JOIN HANJU_NORMAL_SELL NS ON BEST.PRODUCT_ID = NS.PRODUCT_ID
		INNER JOIN HANJU_IMAGE I ON P.PRODUCT_ID = I.FK_ID AND I.FILE_STATUS = 'T'
	</select>
	
	<select id="getBestWineList" resultType="com.example.hanju.mainPage.model.BestWine">
		SELECT  
			BEST.PRODUCT_ID, 
			P.PRODUCT_NAME, 
			P.PRICE, 
			I.FILE_PATH
		FROM    (
			SELECT  PRODUCT_ID, KIND, COUNT(*) AS CNT
			FROM    HANJU_BILL
			WHERE   KIND = 'P'
			GROUP BY PRODUCT_ID, KIND
			ORDER BY CNT DESC
			OFFSET 0 ROWS FETCH FIRST 10 ROWS ONLY
		) BEST
		INNER JOIN HANJU_PRODUCT P ON BEST.PRODUCT_ID = P.PRODUCT_ID
		INNER JOIN HANJU_IMAGE I ON BEST.PRODUCT_ID = I.FK_ID AND I.FILE_STATUS = 'T'
	</select>
	
	<select id="getBestGroupSell" resultType="com.example.hanju.mainPage.model.BestGroupSell">
		SELECT  BEST.GROUP_SELL_ID, P.PRODUCT_NAME, P.PRICE, GS.DISCOUNT, I.FILE_PATH
		FROM    (
		    SELECT  GROUP_SELL_ID, COUNT(*) AS CNT
		    FROM    HANJU_GROUP_SELL_STAT
		    GROUP BY GROUP_SELL_ID
		    ORDER BY CNT DESC
		    OFFSET 0 ROWS FETCH FIRST 10 ROWS ONLY
		) BEST
		INNER JOIN HANJU_GROUP_SELL GS ON BEST.GROUP_SELL_ID = GS.GROUP_SELL_ID
		INNER JOIN HANJU_PRODUCT P ON GS.PRODUCT_ID = P.PRODUCT_ID
		INNER JOIN HANJU_IMAGE I ON P.PRODUCT_ID = I.FK_ID AND I.FILE_STATUS = 'T'
	</select>
	
	<select id="getNewReview" resultType="com.example.hanju.mainPage.model.NewReview">
		SELECT  SUBSTR(U.USER_NAME, 1, 1) || '*' || SUBSTR(U.USER_NAME, 3, 1) AS USER_NAME, C.CONTENT, C.GRADE, I.FILE_PATH
		FROM    HANJU_COMMENT C
		INNER JOIN HANJU_USER U ON C.USER_ID = U.USER_ID
		INNER JOIN HANJU_IMAGE I ON C.COMMENT_ID = I.FK_ID
		ORDER BY C.CDATETIME DESC
		OFFSET 0 ROWS FETCH FIRST 10 ROWS ONLY
	</select>
</mapper>