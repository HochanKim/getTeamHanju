<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hanju.productBoard.mapper.GroupProductMapper">
	<!-- 공동구매 물품 카드형 목록 -->
	<select id="getGroupSellList" parameterType="hashmap" resultType="com.example.hanju.productBoard.model.entity.GroupSellModel">
		SELECT
		    G.GROUP_SELL_ID,
		    G.TARGET_AMOUNT,
		    TO_CHAR(G.END_DATE, '""YYYY"년 "MM"월 "DD"일"') AS END_DATE,
		    G.DISCOUNT,
		    G.PRODUCT_ID,
		    P.PRODUCT_NAME,
		    P.PRICE,
		    NVL(J.CURRENT_AMOUNT, 0) AS CURRENT_AMOUNT,
            I.FILE_PATH,
            I.FILE_ORG_NAME
		FROM	
			HANJU_GROUP_SELL G
		INNER JOIN 
			HANJU_PRODUCT P ON G.PRODUCT_ID = P.PRODUCT_ID
        INNER JOIN 
        	HANJU_IMAGE I ON I.FK_ID = P.PRODUCT_ID
		LEFT JOIN (
		        SELECT  GROUP_SELL_ID, COUNT(*) AS CURRENT_AMOUNT
		        FROM    HANJU_GROUP_SELL_STAT
		        GROUP BY GROUP_SELL_ID
		    ) J ON G.GROUP_SELL_ID = J.GROUP_SELL_ID
        WHERE 
        	I.FILE_STATUS = 'T'
		ORDER BY 
			G.START_DATE
	</select>
	

</mapper>
	
