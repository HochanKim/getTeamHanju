<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hanju.productBoard.mapper.SaleMapper">
	<!-- 전체상품(전통주, 일반구매) -->
	<select id="getProductList" parameterType="hashmap" resultType="com.example.hanju.productBoard.model.entity.SaleModel">
		SELECT PRODUCT_NAME, TO_CHAR(PRICE, 'FM99,999') AS PRICE_COMMA, ALCOHOL, FILE_ORG_NAME, FILE_PATH
		FROM HANJU_NORMAL_SELL NS
		INNER JOIN HANJU_PRODUCT P ON P.PRODUCT_ID = NS.PRODUCT_ID
		LEFT JOIN HANJU_IMAGE I ON P.PRODUCT_ID = I.FK_ID
		INNER JOIN HANJU_CODE C ON P.TYPE = C.CODE
		WHERE I.FILE_STATUS = 'T' AND C.PARENT_CODE = 'T'
	</select>
	
	<!-- 전체상품 > 전통주 -->
	<select id="getTradAlcohol" parameterType="hashmap" resultType="com.example.hanju.productBoard.model.entity.SaleModel">
		SELECT PRODUCT_NAME, TO_CHAR(PRICE, 'FM99,999') AS PRICE_COMMA, ALCOHOL, FILE_ORG_NAME, FILE_PATH
		FROM HANJU_NORMAL_SELL NS
		INNER JOIN HANJU_PRODUCT P ON P.PRODUCT_ID = NS.PRODUCT_ID
		LEFT JOIN HANJU_IMAGE I ON P.PRODUCT_ID = I.FK_ID
		INNER JOIN HANJU_CODE C ON P.TYPE = C.CODE
		WHERE I.FILE_STATUS = 'T'
		<if test="codeList != null">
			AND P.TYPE IN 
			<foreach collection="codeList" item="item" open="(" close=")" separator=",">
				#{item}
			</foreach>
		</if>
		<choose>
			<when test="alcohol == 1">
				(ALCOHOL >= 0 AND 10 > ALCOHOL)
			</when>
			<when test="alcohol == 2">
				(ALCOHOL >= 10 AND 20 > ALCOHOL)
			</when>
			<when test="alcohol == 3">
				(ALCOHOL >= 20 AND 30 > ALCOHOL)
			</when>
			<when test="alcohol == 4">
				(ALCOHOL >= 30)
			</when>
		</choose>
		AND NOT (P.TYPE = 'G' OR C.PARENT_CODE = 'W')
	</select>
	<!-- 전체상품 > 선택 코드 리스트 -->
	<select id="selectCodeList" parameterType="hashmap" resultType="com.example.hanju.productBoard.model.entity.SaleCodeModel">
		SELECT C1.KIND, C2.CODE_NAME, C2.CODE
		FROM HANJU_CODE C1
		INNER JOIN HANJU_CODE C2 ON C1.CODE = C2.PARENT_CODE
		WHERE C1.KIND = 'IMAGE_STATUS' AND NOT C2.CODE = 'G'
	</select>

	<!-- 전체상품 > 선물세트 -->
	<select id="getGiftSet" parameterType="hashmap" resultType="com.example.hanju.productBoard.model.entity.SaleModel">
		SELECT DISTINCT PRODUCT_NAME, TO_CHAR(PRICE, 'FM99,999') AS PRICE_COMMA, ALCOHOL, FILE_ORG_NAME, FILE_PATH
	    FROM HANJU_NORMAL_SELL NS
		INNER JOIN HANJU_PRODUCT P ON P.PRODUCT_ID = NS.PRODUCT_ID
	    LEFT JOIN HANJU_IMAGE I ON P.PRODUCT_ID = I.FK_ID
        INNER JOIN HANJU_CODE C ON P.TYPE = C.CODE
	    WHERE I.FILE_STATUS = 'T' AND P.TYPE = 'G'
	</select>
</mapper>